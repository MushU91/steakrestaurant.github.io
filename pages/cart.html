<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <div class="container my-5">
      <h1 class="text-center h2">Your Cart</h1>
      <table class="table my-3 p-2">
        <tr>
          <th>Product</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Total</th>
          <th>Action</th>
        </tr>
        <tbody id="cart-body">
          <!-- cart table -->
        </tbody>
      </table>
      <div class="text-end h2">
        <h3>Total: $ <span id="cart-total">0</span></h3>
      </div>
      <a href="../index.html" class="btn btn-secondary">Back to Home Page</a>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const cartBody = document.getElementById("cart-body");
        const cartTotal = document.getElementById("cart-total");
        const cart = JSON.parse(sessionStorage.getItem("cart")) || {};

        function updateCart() {
          cartBody.innerHTML = "";
          let total = 0;

          for (const [name, details] of Object.entries(cart)) {
            const itemTotal = details.price * details.quantity;
            total += itemTotal;

            const row = document.createElement("tr");
            row.innerHTML = `

                        <td>${name}</td>
                        <td>$ ${details.price}</td>
                        <td> ${details.quantity}</td>
                        <td>${itemTotal.toFixed(2)}</td>
                        <td><button class="btn btn-danger remove-item" data-name="${name}">Remove</button></td>
                        `;
            cartBody.appendChild(row);
          }
          cartTotal.textContent = total.toFixed(2);

          //attach delete events after rendering table
          const removeButtons = document.querySelectorAll(".remove-item");
          removeButtons.forEach((btn) => {
            btn.addEventListener("click", (e) => {
              const itemName = e.target.getAttribute("data-name");
              delete cart[itemName];
              sessionStorage.setItem("cart", JSON.stringify(cart));
              updateCart();
            });
          });
        }
        updateCart();
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
